직각삼각형 RHA/RHS 합동 발견 웹앱 — 최종 PRD
0. 정의

RHA: Right(직각)–Hypotenuse(빗변)–Angle(한 예각)

RHS: Right(직각)–Hypotenuse(빗변)–Side(한 직각변)

DoF(자유도): 현재 제약에서 움직일 수 있는 독립적 자유 수(0~2)입니다.

거울상 허용: 반사 대칭 포함시에도 합동으로 판정합니다.

1. 목표와 범위
1.1 제품 목표

조작 기반 발견으로 RHA/RHS 합동 조건의 결정성(유일성)을 체감하고, 정당화 문장을 작성하게 합니다.

1.2 비목표

모든 합동 조건(SSS/SAS/ASA) 전체를 단일 앱에서 완결하지 않습니다.

기호 증명 자동생성은 보조 수준(정당화 틀 제공)까지만 합니다.

1.3 성공 지표(KPI)

① RHA·RHS 합동 도달률 ≥ 85%

② 평균 합동까지 시도 횟수 ≤ 5회

③ 정당화 문장(CER) 완성률 ≥ 80%

④ 수업 40분 내 완주율 ≥ 90%

2. 사용자 및 시나리오
2.1 페르소나

학생(중2~3): 터치/마우스 조작, 시각 피드백 선호, 즉각적 힌트 필요합니다.

교사: 활동 배포/진도 모니터링/루브릭 평가, 오개념 탐지에 관심이 있습니다.

2.2 핵심 플로우(요약)

자유 탐색 → 2) 제약 추가(직각/빗변/각·변 잠금) → 3) 복제·이동/회전/대칭 →

겹쳐보기+합동 판정 → 5) 정당화 문장 작성(CER) → 6) 제출/리포트

3. 기능 요구사항
3.1 캔버스/조작

점 3개로 직각삼각형 생성(직각 꼭짓점 선택 또는 자동 판정)합니다.

직각 잠금, 빗변 자동 인식, 각/변 잠금(수치 입력/슬라이더/드래그) 제공합니다.

복제, 이동/회전/대칭(1° 스냅, Shift=15°), 되돌리기/다시하기 무제한 제공합니다.

측정 HUD: 마우스 오버 시 길이·각·잠금 상태·허용오차를 툴팁으로 노출합니다.

격자/스냅: 10px 기본, 스냅 강/중/약(또는 해제) 옵션을 제공합니다.

3.2 모드별 탐색

RHS 모드

순서 가이드: 직각 잠금 → 빗변 길이 잠금 → 한 직각변 길이 잠금 → DoF=0 확인

자취 표시: 세 번째 꼭짓점 **자취(점군/곡선)**가 점으로 수렴하면 “유일 결정” 배지 점등합니다.

RHA 모드

순서 가이드: 직각 잠금 → 빗변 길이 잠금 → 한 예각 잠금(직각 제외) → DoF=0

각도 핸들 + 수치 입력(0~90°, 기본 스냅 1°, 옵션 5°)을 제공합니다.

3.3 합동 검증/겹침

대응 매칭 자동화(오차 최소 매칭) + 수동 고정(A↔A′ 등 핀 고정) 제공합니다.

거울상 허용: 반사 포함 판정합니다(배지에 “(mirror OK)” 표시).

실시간 판정: 합동이면 상단 배지(RHA/RHS) 표시, 패널에 근거 카드를 출력합니다.

겹쳐보기: 반투명 오버레이(투명도 20~80%), 자동 정렬/수동 드래그/미소 회전 가이드를 제공합니다.

비교 패널: 두 도형의 변·각 테이블, 일치=녹색/불일치=적색, 차이값(Δ) 표시합니다.

3.4 발견 유도/가이드

위저드(초보자): 필수 단계 완료 시 다음 단계 활성화, “무엇이 부족한가?” 힌트 제공합니다.

자유 탐색: 힌트 최소화, 요청 시에만 노출합니다.

발견 시 축하 애니메이션 및 “발견 노트” 자동 생성(조건·스크린샷·설명 문장)합니다.

3.5 정당화 문장(CER) 작성

템플릿 제공:

Claim: “직각 & 빗변=…, (각=… 또는 변=…)이면 두 삼각형은 합동이다.”

Evidence: 측정값/잠금/겹침 스냅샷 자동 첨부합니다.

Reasoning: “조건이 DoF=0 → 유일 삼각형 → 합동” 틀 + RHA/RHS 명칭을 제공합니다.

AI 피드백(LLM): 논리 누락·대응점 언급 누락·용어 오류를 탐지하여 구체 코멘트 생성합니다.

3.6 교사용 대시보드

실시간 지표: 각 학생의 제약 상태, DoF, 합동 여부, 시도 횟수, 소요 시간, CER 상태를 제공합니다.

오개념 알림: SSA 착각, 예각=직각 선택 오류, 대응점 미스매치 등 자동 감지합니다.

리포트: 활동 요약(PDF/CSV), 학생별 스냅샷/문장/로그를 내보냅니다.

4. 기하 커널/알고리즘
4.1 판정/허용오차(기본)

길이: ±max(1%, 0.5px)

각도: ±1°(교사 설정 0.5°~2°)

직각 판정: |cos θ| ≤ cos(90°−tol) 임계로 판정합니다.

불가능 제약 방지:

선택 예각 = 0°/90° 금지

변 ≥ 빗변 금지(직각삼각형 특성 위반)

빗변·변·각 조합이 삼각 부등식/삼각함수에 모순 시 경고합니다.

4.2 합동 판정 로직

두 삼각형에서 직각 꼭짓점과 빗변을 식별합니다.

대응 매칭: 직각 꼭짓점 대응을 고정, 나머지 두 꼭짓점 순열 2가지 평가 → 오차합 최소를 채택합니다.

RHA 조건: 직각 OK ∧ 빗변 길이 OK ∧ 선택 예각 OK → 합동입니다.

RHS 조건: 직각 OK ∧ 빗변 길이 OK ∧ 한 직각변 길이 OK → 합동입니다.

거울상 허용: 반사 변환 포함 최소오차가 임계 이하이면 합동입니다.

4.3 자유도(DoF) 산정

무제약(점3자유) → 2

직각만 → 2

직각+빗변 → 1

직각+빗변+(예각 또는 직각변) → 0

UI: 링 게이지(2→1→0) + 텍스트 “이 조건이면 유일하게 결정됩니다”를 표시합니다.

5. UX/UI 요구
5.1 레이아웃

좌: 도구 모음, 중앙: 조작 영역(≥ 800×600), 우: 측정·비교 패널, 하단: 가이드/노트입니다.

색각친화 팔레트 + 패턴 해칭 병행으로 요소 구분합니다.

단위 전환: px/임의단위/cm(인쇄 대비) 전환합니다.

5.2 접근성/키보드

Tab으로 객체 순회, 방향키 미세 이동, Alt/Shift 조합으로 1°/5° 회전합니다.

스크린리더: “직각삼각형 ABC, 빗변=…, ∠A=…” 상태 요약을 실시간 제공합니다.

6. 데이터·API
6.1 클라이언트 상태(JSON 스키마)
{
  "triangles": [{
    "id": "t1",
    "points": {"A":[x,y],"B":[x,y],"C":[x,y]},
    "locks": {
      "rightAt": "C",                // "A"|"B"|"C"|null
      "hypotenuse": {"len": 120.0},  // px or unit
      "angle": {"at":"A","deg":35.0},
      "side": {"name":"AC","len":80.0}
    },
    "meta": {"name":"원본","color":"#..."}
  }],
  "snapshots": [{
    "id":"s1","triangleIds":["t1","t2"],"img":"data:url","ts":173...,
    "metrics":{"dof":0,"isCongruent":true,"mode":"RHA"}
  }],
  "claims": [{
    "id":"c1","snapshotId":"s1",
    "claim":"직각&빗변=…&∠A=…이면 합동",
    "evidence":["s1","표1"],
    "reasoning":"DoF=0→유일→합동(RHA)",
    "rubric":{"completeness":3,"precision":2,"mapping":2,"total":7}
  }]
}

6.2 이벤트 로그

lock_added/removed, dof_changed, congruence_passed/failed, overlay_used, angle_input, side_input, mirror_checked, claim_submitted 등을 기록합니다.

6.3 LLM 연동(내장 함수 사양)

generate_hint(state, lastError) -> hintText

evaluate_CER(claim, evidence, state) -> {scores, comments, fixes}

detect_misconception(log) -> {type, message, nextPrompt}

7. 성능·품질·보안
7.1 성능

포인터 이동~렌더 < 16ms(60fps), 히트테스트 1ms 이하, 5천 오브젝트에서 부드럽습니다.

수치 안정화: ε 비교 + 히스테리시스(스냅 깜빡임 방지) 적용합니다.

7.2 보안/프라이버시

PII 저장 금지, 학생 익명 ID 사용합니다.

로컬 IndexedDB 기본 + 선택적 동기화(수업 코드) 제공합니다.

7.3 오프라인/PWA

설치형(PWA), 네트워크 불안정 시 활동 지속/동기화 재시도합니다.

8. 교사 기능(저작/평가)
8.1 과제 템플릿

RHS 미션: “직각@C, |AB|=8, |AC|=5로 고정 후 복제하여 겹치기(±1%)”

RHA 미션: “직각@C, |AB|=6, ∠A=35°로 고정 후 자유도 0 확인(±1°)”

허용오차·힌트레벨·시간제한을 프리셋으로 제공합니다.

8.2 루브릭(자동+수정 가능)

정확성(수치/대응점), 정당화 논리, 표현의 명확성 3축(각 0~3)으로 기본 채점합니다.

교사 코멘트/가중치를 덮어쓸 수 있습니다.

9. 오류/엣지케이스 처리

모순 제약: 즉시 UI 배지 “제약 충돌” + 해제 제안(예: “∠A는 직각이 될 수 없습니다”).

불충분 제약: DoF>0일 때 합동 요청 시 “조건이 부족합니다: (예각/직각변) 잠금이 필요합니다.”

픽셀 스케일 이슈: 너무 작은 도형 경고(선택 시 자동 확대)합니다.

10. 수용 기준(샘플 테스트)
10.1 기능 테스트

[RHA-001] 직각@C, |AB|=120, ∠A=35° → DoF=0, 합동 배지=RHA가 항상 점등합니다.

[RHS-002] 직각@C, |AB|=100, |AC|=60 → 복제 후 회전/대칭 시에도 합동=True입니다.

[MIR-003] 위 상태에서 y축 대칭본과도 합동=True입니다.

[DOF-004] 직각만 잠금 → DoF=2, 직각+빗변 → DoF=1, 조건 추가 시 DoF=0으로 갱신합니다.

[ERR-005] ∠A=90° 입력 시 거부 + 경고 메시지를 표시합니다.

[TOL-006] 각 오차 1.2°에서 합동 실패, 0.8°에서 성공합니다(기본 tol=1°).

[MAP-007] 자동 대응 오매칭 시 수동 핀 고정으로 수정 가능해야 합니다.

10.2 성능/UX

[PERF-010] 포인터 이동 중 프레임 드랍이 눈에 띄지 않습니다(60fps 체감).

[A11Y-011] 키보드만으로 제약 추가~합동 확인까지 수행 가능합니다.

[SR-012] 스크린리더가 현재 상태 요약을 정확히 읽어줍니다.

11. 기술 스택/아키텍처(권장)

FE: React + TypeScript, Canvas(Skia/Konva)/SVG 혼합, Zustand/Recoil 상태관리, Vite 빌드

기하 유틸: 벡터/행렬/삼각함수 래퍼 + 강건한 판정(Adaptive Predicates)

스타일: Tailwind, 다크모드, i18n(ko 기본)

PWA: Workbox, IndexedDB(보관/복구)

12. AI 개발을 위한 작업 분해(Agent To-Do)

기하 커널

 직각 판정, 빗변 식별, 각/변 잠금 제약 해석기

 자유도 계산기 및 자취 생성기

 합동 판정(대응 매칭 + 오차 모델 + 거울상)

렌더러/조작기

 점/변/각 핸들, 스냅/오버레이/정렬/대칭

 HUD/툴팁/겹쳐보기/애니메이션

가이드/위저드

 단계별 체크리스트 + 차단/진행 로직

 불충분/충돌 제약 감지 → 힌트 훅

CER/피드백(LLM)

 CER 템플릿/체커, 오개념 분류기, 수정 제안 프롬프트

교사 대시보드/리포트

 실시간 집계, 로그 스키마, PDF/CSV 익스포트

품질/테스트

 시뮬레이션 테스트(난수 삼각형), TOL/DoF/합동 경계 테스트

 접근성/키보드/스크린리더 스펙 검증

13. 로드맵(권장)

MVP(3~4주): RHA/RHS 조작·합동 판정·겹쳐보기·DoF·기본 CER 제출

Beta: 교사 대시보드·오개념 힌트·리포트·PWA

v1.0: 자취/작도 도구·i18n·접근성 고도화·템플릿 저작

14. 향후 확장

일반 삼각형 SSS/SAS/ASA 모드, 외심/내심 연계 보기, 증명 절차 시각화, 학습분석 기반 난이도 조절을 제공합니다.

마무리

본 PRD는 제약-기반 조작 → 자유도 시각화 → 합동 검증 → 정당화 문장의 일관 흐름을 중심으로, AI 구현 관점의 세부 사양(알고리즘/데이터/수용 기준)을 포함했습니다. 그대로 개발에 착수해도 무리가 없으며, 필요 시 미션 템플릿과 LLM 프롬프트 세트를 추가로 제공하겠습니다.