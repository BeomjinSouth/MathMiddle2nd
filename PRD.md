## 중2 평면도형 정당화(증명) 시각화 도구 – 통합 PRD (이등변삼각형 + 직각삼각형 RHA/RHS)

### 1. 목표/배경
- **목표**: 학생이 직접 조작하며 정당화(증명)의 흐름을 체험한다.
- **핵심 가치**: 정의 → 보조선/제약 → 합동/판정 → 결론(CER)까지 시각·행동 기반 학습.
- **범위**: 
  - 모듈1: 이등변삼각형(기본 증명 2-1, 확장 2-2)
  - 모듈2: 직각삼각형 RHA/RHS(발견형, DoF 기반 합동 판정)

### 2. 사용자
- **학생(핵심)**: 중2, 기하 도구 초심자. 단계 가이드/힌트 필요.
- **교사(보조)**: 시연/과제 부여. 진행 요약과 산출물(요약/스냅샷) 활용.

### 3. 성공 지표(KPI)
- **이등변(모듈1)**: 3단계 완료율 ≥ 70%, 중간 도달 시간 ≤ 6분, 힌트 평균 ≤ 2/단계, 1주 재방문 ≥ 25%
- **RHA/RHS(모듈2)**: 합동 도달률 ≥ 85%, 평균 시도 ≤ 5회, CER 완성률 ≥ 80%, 40분 완주 ≥ 90%

### 4. 정보 구조(IA)·라우팅
- `/` 홈
- `/isosceles` 이등변삼각형 실습(정의/성질 요약 + 보드)
- `/isosceles/steps/:id` 단계 뷰(1,2,3,2-2)
- `/summary/isosceles` 이등변 요약
- `/rha-rhs` 직각삼각형 모듈 허브(모드 선택)
- `/rha-rhs/mode/:mode` `mode ∈ {RHA, RHS}`

### 5. 기능 요구사항

#### 5.1 공통(보드/도구/상태)
- **보드**: 포인트/선분/직선/각/교점/각 이등분선/측정 도구, 줌/패닝, 격자/스냅, 실행 취소/초기화.
- **검증 엔진**: 각/길이/수직/중점/합동/DoF 계산(허용오차 적용). 기준 충족 시 단계/배지 활성화.
- **피드백**: 하이라이트(대응변 색, 수직=빨강 점선, 이등분선=보라), 체크리스트, 요약 카드.
- **접근성**: 키보드 포커스/숫자키 전환, ARIA 레이블, 색각 보정 팔레트.
- **분석(초기)**: 단계 완료/소요시간/힌트 클릭(로컬·콘솔; 향후 이벤트 수집).

#### 5.2 모듈1: 이등변삼각형
- **핵심 시나리오**
  1) 홈→이등변 클릭→실습 진입
  2) 1단계: ∠A 이등분선 그어 BC와 교점 D 생성
  3) 2단계: △ABD ≡ △ACD(SAS) 확인(AB=AC, ∠BAD=∠CAD, AD 공통)
  4) 3단계: ∠B = ∠C 결론 확인(측정/합동 대응각)
  5) 확장 2-2: AD가 BC의 수직이등분선(BD=DC, ∠ADB=∠ADC=90°)
- **자동 체크**
  - 1단계: ∠BAD≈∠CAD, D∈BC
  - 2단계: AB≈AC, ∠BAD≈∠CAD, AD 공통 → SAS 합동 하이라이트
  - 3단계: ∠B≈∠C
  - 확장: BD≈DC, AD ⟂ BC(90°)
- **비기능**: 반응형/60fps 렌더, 오프라인 기본 조작.

#### 5.3 모듈2: 직각삼각형 RHA/RHS 합동 발견
- **목표**: 제약(직각/빗변/각·변 잠금) 추가로 DoF→0(유일 결정)을 체감하고 합동을 판정.
- **조작**: 점 3개로 직각삼각형 생성(직각 꼭짓점 자동/수동), 직각 잠금, 빗변 인식, 각/변 잠금(수치 입력/슬라이더/스냅 1°/5°), 복제/이동/회전/대칭, 스냅/격자(10px, 강/중/약/해제).
- **HUD/측정**: 길이·각, 잠금 상태, 허용오차 툴팁.
- **모드 가이드**
  - RHS: 직각 잠금 → 빗변 길이 잠금 → 한 직각변 길이 잠금 → DoF=0
  - RHA: 직각 잠금 → 빗변 길이 잠금 → 한 예각 잠금 → DoF=0
- **합동 검증/겹침**: 자동 대응 매칭(+수동 핀 고정), 거울상 허용, 합동 배지(RHA/RHS), 비교 표(변/각 Δ), 겹쳐보기 오버레이(투명 20~80%, 자동 정렬+미세 회전 가이드).
- **발견 유도**: 위저드(부족 조건 힌트)/자유탐색(요청 시 힌트), 발견 노트(조건·스냅샷·설명) 자동 생성.
- **CER 작성**: Claim/Evidence/Reasoning 템플릿, 측정값/잠금/스냅샷 첨부, DoF=0→유일→합동 논리 안내.

### 6. 검증/알고리즘(요건)
- **허용오차(기본)**: 길이 ±max(1%, 0.5px), 각 ±1°(교사 설정 0.5°~2°)
- **이등변**: 각 이등분 판정(∠BAD≈∠CAD), 점-선분 포함, SAS 합동, 밑각 동일, 수직이등분 판정.
- **직각 판정**: |cos θ| ≤ cos(90°−tol)
- **합동(RHA/RHS)**:
  - 직각 꼭짓점/빗변 식별
  - 대응 매칭(직각 대응 고정 + 나머지 2점 최소오차)
  - RHA: Right ∧ Hypotenuse ∧ Angle → 합동
  - RHS: Right ∧ Hypotenuse ∧ 한 직각변 → 합동
  - 거울상 허용 옵션: 반사 포함 최소오차 임계 이하
- **자유도(DoF)**: 직각만=2 → 직각+빗변=1 → +예각/직각변=0(링 게이지/UI 배지)

### 7. 상태/데이터 모델
- **공통 `LessonState`(요약)**
  - `currentStep`: '1' | '2' | '3' | '2-2' (모듈1)
  - `selectedTool`: 도구 상태, `board` 참조, `checks` 단계별 결과, `tolerance`(angleDeg, lengthPx)
  - `objects`, `constraints`(equal/perpendicular/midpoint/angle_bisector 등)
- **모듈2 확장**
  - `mode`: 'ISOSCELES' | 'RHA' | 'RHS'
  - `triangles[]`: `points{A,B,C}`, `locks{rightAt,hypotenuse,angle,side}`
  - `overlays`: { active, opacity, mirrorAllowed }
  - `snapshots[]`, `claims[]`, `logs[]`

### 8. UI/툴바/HUD
- **툴바**: 선택/점/직선/선분/각/이등분선/교점/측정/삭제 + 실행취소/초기화.
- **측정 HUD**: 각/길이 수치, 잠금 상태, 허용오차 표시.
- **겹쳐보기**(모듈2): 오버레이 토글/투명도, 핀 고정, 자동 정렬.

### 9. 접근성/국제화
- 키보드로 점 순환/도구 전환(숫자키), 색 대비 4.5:1, 고대비 모드, 다국어 확장 구조.

### 10. 분석/로그(모듈2 포함)
- `lock_added/removed`, `dof_changed`, `congruence_passed/failed`, `overlay_used`, `angle_input`, `side_input`, `mirror_checked`, `claim_submitted` 등.

### 11. 비기능
- 반응형(360/768/1024+), 60fps 줌/패닝, 오프라인 기본 조작, 수치 안정화(ε 비교·히스테리시스).

### 12. 수용 기준(발췌)
- **모듈1(이등변)**
  - 이등분선 도구로 AD 생성·D 라벨 생성 가능.
  - 검증 클릭 시 각 단계 기준이 시각적으로 피드백.
  - 합동 결과 대응변 하이라이트, “∠B=∠C”, “AD는 BC의 수직이등분선” 측정/아이콘 확인.
  - 모바일에서 기본 플로우 수행 가능.
- **모듈2(RHA/RHS)**
  - RHA: 직각@C, |AB|=120, ∠A=35° → DoF=0, 합동 배지 점등.
  - RHS: 직각@C, |AB|=100, |AC|=60 → 복제·회전·대칭해도 합동=True.
  - 오차 경계: 각 1.2° 실패, 0.8° 성공(기본 tol=1°). 수동 핀 고정으로 대응 수정 가능.

### 13. 리스크·대응
- **정확도 vs 사용성**: 허용오차/스냅 튜닝, 시각적 가이더 제공.
- **러닝커브**: 위저드·힌트 단계화, 예제 프리셋.
- **성능**: 히트테스트 ≤1ms, 대량 오브젝트에서도 부드럽게.

### 14. 마일스톤(권장)
- 주1: IA/와이어/보드 PoC, 잠금/측정/HUD 기초
- 주2: 모듈1 단계1~2, 모듈2 RHA/RHS 위저드 베타
- 주3: 모듈1 단계3·2-2, 모듈2 합동 검증/겹쳐보기/핀 고정
- 주4: CER/요약/스냅샷/로그, 접근성/반응형
- 주5: QA/튜닝/가이드 문서화

### 15. 기술 스택/폴더 구조
- **프런트**: React + TypeScript + Vite
- **기하 보드**: JSXGraph
- **상태**: Zustand, 라우팅: React Router, 스타일: Tailwind
- **테스트**: Vitest + Testing Library, E2E: Playwright
- **폴더**
```
src/
  pages/
  components/
    Board/
    Sidebar/
    Toolbar/
    Checklist/
  hooks/
  state/
  utils/geometry/
  assets/
  config/steps/
```

### 16. 구현 메모(현 상태 반영)
- 보드·툴 연동(점/선분/각/이등분선/삭제), 단계 검증(각/길이/수직/중점 일부 구현), 실행 취소/초기화.
- 이후 작업: 측정 UI 표시(각·길이 값), RHA/RHS 잠금·DoF 게이지·겹쳐보기·합동 판정·CER UI.


